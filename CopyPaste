<!--
    Visualforce Page: SubscriptionsViewer
    Purpose:
    - Show SBQQ__Subscription__c records
    - Allow filtering
    - Allow sorting
    - Allow pagination
-->

<apex:page controller="SubscriptionsViewerController"
           lightningStylesheets="true"
           showHeader="true"
           sidebar="true">

    <!-- Every interactive VF page needs a form -->
    <apex:form id="theForm">

        <!-- Displays validation or Apex messages -->
        <apex:pageMessages />

        <!-- ============================= -->
        <!-- FILTER SECTION -->
        <!-- ============================= -->
        <apex:pageBlock title="Subscription Filters">

            <!-- 4 columns layout -->
            <apex:pageBlockSection columns="4">

                <!-- Account Lookup -->
                <!-- Binds to wrapper property in controller -->
                <apex:inputField value="{!filterAccount.AccountId}" label="Account" />

                <!-- Status dropdown -->
                <apex:selectList value="{!status}" size="1" label="Status">
                    <apex:selectOptions value="{!statusOptions}" />
                </apex:selectList>

                <!-- Search text -->
                <apex:inputText value="{!searchText}" label="Search (Name/Product)" />

                <!-- Empty cell for layout alignment -->
                <apex:pageBlockSectionItem />

                <!-- Date Filters -->
                <apex:inputText value="{!startDateFrom}" label="Start Date From (YYYY-MM-DD)" />
                <apex:inputText value="{!startDateTo}" label="Start Date To (YYYY-MM-DD)" />
                <apex:inputText value="{!endDateFrom}" label="End Date From (YYYY-MM-DD)" />
                <apex:inputText value="{!endDateTo}" label="End Date To (YYYY-MM-DD)" />

            </apex:pageBlockSection>

            <!-- Filter Buttons -->
            <apex:pageBlockButtons>
                <apex:commandButton value="Apply Filters"
                                    action="{!applyFilters}" />

                <apex:commandButton value="Reset"
                                    action="{!resetFilters}" />
            </apex:pageBlockButtons>

        </apex:pageBlock>


        <!-- ============================= -->
        <!-- RESULTS TABLE -->
        <!-- ============================= -->
        <apex:pageBlock title="Subscriptions">

            <apex:pageBlockTable value="{!subscriptions}" var="s">

                <!-- Name Column -->
                <apex:column headerValue="Name">
                    <apex:outputLink value="/{!s.Id}">
                        {!s.Name}
                    </apex:outputLink>
                </apex:column>

                <!-- Account Column -->
                <apex:column headerValue="Account">
                    <apex:outputLink value="/{!s.SBQQ__Account__c}">
                        {!s.SBQQ__Account__r.Name}
                    </apex:outputLink>
                </apex:column>

                <!-- Product -->
                <apex:column headerValue="Product">
                    <apex:outputText value="{!s.SBQQ__Product__r.Name}" />
                </apex:column>

                <!-- ============================= -->
                <!-- SORTABLE COLUMN EXAMPLE -->
                <!-- ============================= -->

                <apex:column>
                    <apex:facet name="header">
                        <!-- Calls controller sort() method -->
                        <apex:commandLink action="{!sort}">
                            Status
                            <!-- Pass which column to sort -->
                            <apex:param name="col"
                                        value="SBQQ__Status__c"/>
                        </apex:commandLink>
                    </apex:facet>

                    <apex:outputText value="{!s.SBQQ__Status__c}" />
                </apex:column>

                <!-- Start Date -->
                <apex:column>
                    <apex:facet name="header">
                        <apex:commandLink action="{!sort}">
                            Start Date
                            <apex:param name="col"
                                        value="SBQQ__StartDate__c"/>
                        </apex:commandLink>
                    </apex:facet>
                    <apex:outputText value="{0,date,yyyy-MM-dd}">
                        <apex:param value="{!s.SBQQ__StartDate__c}" />
                    </apex:outputText>
                </apex:column>

                <!-- End Date -->
                <apex:column>
                    <apex:facet name="header">
                        <apex:commandLink action="{!sort}">
                            End Date
                            <apex:param name="col"
                                        value="SBQQ__EndDate__c"/>
                        </apex:commandLink>
                    </apex:facet>
                    <apex:outputText value="{0,date,yyyy-MM-dd}">
                        <apex:param value="{!s.SBQQ__EndDate__c}" />
                    </apex:outputText>
                </apex:column>

                <!-- Quantity -->
                <apex:column headerValue="Quantity">
                    <apex:outputText value="{!s.SBQQ__Quantity__c}" />
                </apex:column>

                <!-- Amount -->
                <apex:column headerValue="Amount">
                    <apex:outputText value="{!s.SBQQ__Amount__c}" />
                </apex:column>

            </apex:pageBlockTable>

            <!-- If no records -->
            <apex:outputPanel rendered="{!totalRows == 0}">
                <apex:outputText value="No subscriptions found." />
            </apex:outputPanel>

        </apex:pageBlock>


        <!-- ============================= -->
        <!-- PAGINATION -->
        <!-- ============================= -->

        <apex:pageBlock title="Pagination"
                        rendered="{!totalRows > 0}">

            <apex:commandButton value="First"
                                action="{!first}"
                                disabled="{!isFirstPage}" />

            <apex:commandButton value="Previous"
                                action="{!previous}"
                                disabled="{!isFirstPage}" />

            Page {!pageNumber} of {!totalPages}

            <apex:commandButton value="Next"
                                action="{!next}"
                                disabled="{!isLastPage}" />

            <apex:commandButton value="Last"
                                action="{!last}"
                                disabled="{!isLastPage}" />

            &nbsp; | Page Size:

            <apex:selectList value="{!pageSize}" size="1">
                <apex:selectOption itemValue="10" itemLabel="10"/>
                <apex:selectOption itemValue="25" itemLabel="25"/>
                <apex:selectOption itemValue="50" itemLabel="50"/>
            </apex:selectList>

            <apex:commandButton value="Apply"
                                action="{!applyPageSize}" />

        </apex:pageBlock>

    </apex:form>
</apex:page>
